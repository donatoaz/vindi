{
	"name": {
    "pt_BR": "Criar uma nova assinatura",
    "en": "Create a new subscription"
  },
  "action_key": "create_subscription",
  "description": {
  	"pt_BR": "Criar uma nova assinatura",
    "en": "Create a new subscription"
  },
  "action_fields": {
    "fields": [
        {
            "key": "customer_email",
            "name": { "pt_BR": "cliente email", "en": "customer email" },
            "description": {
                "pt_BR": "O email do cliente",
                "en": "The email of the customer"
            },
            "required": true,
            "visible": true,
            "field_type": "custom",
            "data_type": "string",
            "not_include_field_in_request": true
        },
        {
            "key": "customer_name",
            "name": { "pt_BR": "cliente nome", "en": "customer name" },
            "description": {
                "pt_BR": "O nome do cliente",
                "en": "The name of the customer"
            },
            "required": true,
            "visible": true,
            "field_type": "custom",
            "data_type": "string",
            "not_include_field_in_request": true
        },
        {
            "key": "customer_id",
            "name": { "pt_BR": "cliente id", "en": "customer id" },
            "description": {
                "pt_BR": "O ID do cliente",
                "en": "The ID of the customer"
            },
            "required": true,
            "visible": false,
            "advanced": false,
            "field_type": "custom",
            "data_type": "string",
            "max": 100
        },
        {
            "key": "plan_id",
            "name": { "pt_BR": "plano id", "en": "plan id" },
            "description": {
                "pt_BR": "O ID do plano",
                "en": "The ID of the plan"
            },
            "required": true,
            "visible": true,
            "advanced": false,
            "field_type": "dropdown",
            "data_type": "string",
            "list": {
              "type": "remote",
              "helper_method": "plan_list"
            }
        },
        {
          "key": "payment_method_code",
          "name": {
            "pt_BR": "método pagamento",
            "en": "method payment"
          },
          "description": {
            "pt_BR": "Código do método de pagamento",
            "en": "Payment method code"
          },
          "required": false,
          "visible": true,
          "advanced": true,
          "field_type": "dropdown",
          "data_type": "string",
          "list": {
            "type": "remote",
            "helper_method": "payment_method_list"
          }
        }
    ]
  },
  "request": {
    "method_name": "/bills",
    "json_api": true,
    "error_fields" : ["errors"],
    "pre_hooks":{
      "hooks": [
        {
          "name": "Buscar Cliente",
          "request": {
            "verb": "get",
            "json_api": true,
            "method_name": "/customers",
            "params": [
              {"field": "query", "value": "email:{customer_email}", "type": "string"}
            ],
            "response_field": ["customers"]
          }
        },
        {
          "name": "Criar Cliente",
          "conditions": [
            {"field": "id", "condition": "equal", "value": null}
          ],
          "request": {
            "verb": "post",
            "json_api": true,
            "method_name": "/customers",
            "params": [
              {"field": "name", "value": "{customer_name}", "type": "string"},
              {"field": "email", "value": "{customer_email}", "type": "string"}
            ]
          }
        }
      ],
      "append_fields": [
        {"field": "customer_id", "value": "{customer.id}", "type": "string"}
      ]
    }
  }
}
