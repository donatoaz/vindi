{
  "name":{
    "pt_BR":"Assinatura criada",
    "en":"Subscription created"
  },
  "trigger_key":"subscription_created",
  "description":{
    "pt_BR":"Quando uma assinatura for criada.",
    "en":"When a subscription is created."
  },
  "trigger_fields":{
    "type":"local",
    "fields":[
      {
        "key":"id",
        "name":"id da assinatura",
        "description":"Identificação da assinatura na Vindi",
        "field_type":"string"
      },
      {
        "key":"start_at",
        "name":"data do inicio (formatado - DD/MM/YYYY)",
        "source":"format_date(source[:start_at],%q(%d/%m/%Y))",
        "description":"Data do inicio da assinatura",
        "field_type":"string"
      },
      {
        "key":"end_at",
        "name":"data do fim (formatado - DD/MM/YYYY)",
        "source":"format_date(source[:end_at],%q(%d/%m/%Y))",
        "description":"Data do fim da assinatura",
        "field_type":"string"
      },
      {
        "key":"next_billing_at",
        "name":"data da proxima fatura (formatado - DD/MM/YYYY)",
        "source":"format_date(source[:next_billing_at],%q(%d/%m/%Y))",
        "description":"Data da proxima fatura",
        "field_type":"string"
      },
      {
        "key":"cancel_at",
        "name":"data de cancelamento (formatado - DD/MM/YYYY)",
        "source":"format_date(source[:cancel_at],%q(%d/%m/%Y))",
        "description":"Data de cancelamento da assinatura",
        "field_type":"string"
      },
      {
        "key":"overdue_since",
        "name":"atrasado desde (formatado - DD/MM/YYYY)",
        "source":"format_date(source[:overdue_since],%q(%d/%m/%Y))",
        "description":"Atrasado desde ",
        "field_type":"string"
      },
      {
        "key":"product_items.descriptions",
        "name":"itens descrição",
        "source":"source[:product_items].map{|i|[i[:product][:name],i[:quantity],i[:pricing_schema][:price]].join(%q( | ))}.join(%q(, ))",
        "description":"Descrição de todos os itens (nome, quantidade e preço)",
        "field_type":"string"
      },
      {
        "key":"customer.email",
        "name":"cliente email",
        "description":"E-mail do cliente",
        "field_type":"string"
      },
      {
        "key":"status",
        "name":"status",
        "description":"Status da assinatura na Vindi",
        "field_type":"string"
      },
      {
        "key":"created_at",
        "name":"criado em (YYYY-MM-DDTHH:mm:ss-Z)",
        "source":"source[:created_at]",
        "description":"Data de criação da faturan na Vindi. Pode ser que a data de criação não seja mesma a do pagamento aprovado. Para esta data use a data de atualização.",
        "field_type":"date_time"
      },
      {
        "key":"updated_at",
        "name":"atualizado em (YYYY-MM-DDTHH:mm:ss-Z)",
        "source":"source[:updated_at]",
        "description":"Data da última atualização da transação na Vindi, onde provavelmente houve a última mudança de status.",
        "field_type":"date_time"
      },
      {
        "key":"current_period.billing_at",
        "name":"data de faturamento periodo corrente (YYYY-MM-DDTHH:mm:ss-Z)",
        "description":"Data de faturamento para o período corrente.",
        "field_type":"date_time"
      },
      {
        "key":"current_period.start_at",
        "name":"data do inicio periodo corrente (formatado - DD/MM/YYYY)",
        "source":"format_date(source[:current_period][:start_at],%q(%d/%m/%Y))",
        "description":"Data de inicio para o período corrente",
        "field_type":"string"
      },
      {
        "key":"current_period.end_at",
        "name":"data do fim periodo corrente(formatado - DD/MM/YYYY)",
        "source":"format_date(source[:current_period][:end_at],%q(%d/%m/%Y))",
        "description":"Data de fim para o período corrente",
        "field_type":"string"
      },
      {
        "key":"customer.id",
        "name":"id do cliente",
        "description":"ID do cliente na Vindi.",
        "field_type":"string"
      }
    ]
  },
  "trigger_type":"webhook",
  "webhook":{
    "message_type":"object",
    "field":"event.data.subscription",
    "event_filter":{
      "field":"event.type",
      "events":["subscription_created"]
    },
    "idempotent":[
      {"type":"body", "field":"event.data.subscription.id"},
      {"type":"body", "field":"event.data.subscription.status"}
    ]
  }
}